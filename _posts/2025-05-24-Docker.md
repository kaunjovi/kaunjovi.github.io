---
layout: post
title: Docker
categories: [Docker] 
---

## [Linkedin learning : Docker ](https://www.linkedin.com/learning/learning-docker-17236240/create-a-docker-container-from-dockerfiles-part-2?autoSkip=true&contextUrn=urn%3Ali%3AlyndaLearningPath%3A65eb4388345061d17bc1cba4&resume=false)

1. Get a list of all the docker running 
1. and the ones that are not running too 
```
docker ps 
docker ps -a // this is the all option. 
docker ps -aq // show all, but only the names, not the whole table. 
docker stop xxx // stop the xxx container. Gracefully. 
docker stop -t 0 xxx // Stop now. Data loss? I dont care. 
```
1. Stop and remove the container in one line 

```
docker rm xxx // will not remove the container that are running 
docker stop && docker rm // instead of two commands you could ...
docker rm -f xxx // will removed running container 
```
1. One command to remove all the containers 
```
docker ps -aq | xargs docker rm
```

1. Images are big. They can take a lot of space. Remove them with rmi. 
```
docker images // list all the images 
docker rmi xxx // remove the xxx image. If it is being used by a running container, it will not be removed. 
docker rmi -f xxx // Doing it forcibly. Might have unpredictable results. 
```

1. **Port binding**
1. Port binding. Take a port of the actual machine and bind it to a port of the container. 
``` 
docker run xxx 
docker run --name chunnu xxx // now I have given it a name 
docker run -d --name chunnu xxx // now I am running it in the background. Useful for running servers. 
docker run -d --name chunnu -p 5001:5000 xxx // binding my 5001 to 5000 of image 
```

1. **Volume mounting** 
1. Containers are disposable. When you dispose it, you are disposing the data as well. 
```
docker run --rm //  run and them rm for immediately remove. 
docker run --rm --entrypoint sh //  just run a shell command 
docker run --rm --entrypoint sh ubuntu //  there is no Dockerfile. Use the ubuntu image.
docker run --rm --entrypoint sh ubuntu -c "echo 'Hello there' > /tmp/file && cat /tmp/file" // echo hello into a tmp file and cat it. 
```
1. The echo will be printed, but since container was immediately removed, you will not find the tmp file. 
1. So you mount a folder by --v outsidefolder:insidefolder 
```
docker run --rm --entrypoint sh --volume /tmp/container:/tmp ubuntu -c "echo 'Hello there' > /tmp/file && cat /tmp/file" // mount a Volume
```

1. **Container image registry** 
1. Create an account on Docker hub 

1. **Login**
```
docker login 
username 
password 
``` 
1. Then tag it 

```
docker tag xxx username/xxx:version 
docker tag my-web-server kaunjovi/my-web-server:0.0.1
docker push kaunjovi/my-web-server:0.0.1
```

## How to ensure that the Docker image that  you are using is safe? 
1. Use "official" versions. 
1. If you must use un-official versions, scan them with 
    1. Clair 
    1. Trivy 
    1. Dagda 

## Docker Compose 
1. **How to run multiple connected containers on a single machine?**
1. **How to deploy a three tier web application using Docker?** 
1. For any non trivial application, it is likely to have multiple components. 
1. DONT put all of them in a single Docker. It is not meant for that kind of usage. 
1. You could manually create multiple Docker and connect all of them, 
    1. you could use virtual networks and mounted volumes. 
    1. but IT IS TOO MUCH work. Time consuming and Error prone. 
1. Use **Docker compose** instead. 
1. ?? Read more. 

## Kubernetes - Planet scale container orchestrator 
1. **What are Container Orchestrators? What are they used for?**
1. It is a distributed system. Run and store data across many machines. So it can connect with 100,000s of containers. 
1. It can run on almost anything - starting from raspberry pi - to the largest of machines. 
1. It helps manage traffic to and fro your containers. 


## https://guide.bash.academy/



# [Linkedin certification on Docker by Shelley Benhoff](https://www.linkedin.com/learning/docker-your-first-project/setting-up-your-development-environment?autoSkip=true&contextUrn=urn%3Ali%3AlyndaLearningPath%3A65eb4388345061d17bc1cba4&resume=false)

1. Download and install Docker Desktop 
    1. VSCode 
    1. VSCode extension for Docker. 
1. https://github.com/LinkedInLearning/docker-your-first-project-4485003

```
Add changes to git using this command: git add .
Commit changes using this command: git commit -m "some message"
```

```
Clone this repository into your local machine using the Git Bash command git clone https://github.com/LinkedInLearning/docker-your-first-project-4485003.git
Switch between branches using the Git Bash command git checkout CHAPTER#_MOVIE#
View all available branches using the Git Bash command git branch
```

# Dockerfile cheatsheet 

```Dockerfile
# This is a comment. 

# FROM what base image to use. 
# The base image should have the tools needed to run the application.   
# You can look them up in https://hub.docker.com/repositories/parthaittech
FROM python:3.12-rc-bookworm


WORKDIR /app

COPY . /app 

# Do not store the downloaded files in the cache. Download them anew each time? 
RUN pip install --no-cache-dir -r requirements.txt 

# Set environment variables. Flask needs some. 
ENV FLASK_APP=app.py

# Run this command by default. 
CMD ["flask", "run", "--host=0.0.0.0" ]

```





1. Command : docker build 

```
docker build 
docker build -t our-first-docker-image 

// What is the name of the docker file? If it is not Dockerfile, spell that out. 
docker build -t our-first-docker-image -f app.Dockerfile 
docker build -t our-first-docker-image --file app.Dockerfile

// Where is the context. Is it in the same folder. Just put a dot. 
docker build -t our-first-docker-image . 


```

1. Docker images are layers of images over one another. 
1. So, for every command it creates an impage. So, should we try to use less command? Might be. 
1. These are called intermediate images. 
1. Once it is created you can run it. 

```
docker run our-first-docker-image 
```

1. **What if the container does not exit immediately after execution?** 
1. Build the docker image. Use server.Dockerfile. Context is current folder (.). 
```
docker build --file server.Dockerfile --tag our-first-docker-server . 
docker run our-first-docker-server 
```
1. find the name of the docker and kill it 
```
docker ps 
docker kill xxx 
```
1. This time, be smart. Run it as -d. Make it run in background. 
```
docker run -d our-first-docker-server 
```
1. Huh?? I did something. Did not understand 
```
docker exec xxx date 
```
1. And now we are getting freaky. We are running bash in intereactive mode in the image. 
```
docker exect --intereactive --tty xxx bash 
```





1. **USER command of Linux Ubuntu**
1. root 
1. nobody 

